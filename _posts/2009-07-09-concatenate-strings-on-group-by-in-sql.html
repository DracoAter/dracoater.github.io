---
layout: post
title: Concatenate Strings On Group By In Sql
date: '2009-07-09T14:41:00.000+03:00'
author: Juri Timo≈°in
tags:
- MsSql
- MySql
- PostgreSql
modified_time: '2012-03-29T00:03:30.879+03:00'
blogger_id: tag:blogger.com,1999:blog-360329120074358364.post-4562566573058521701
blogger_orig_url: http://dracoater.blogspot.com/2009/06/concatenate-strings-on-group-by-in-sql.html
---

<div dir="ltr" style="text-align: left;" trbidi="on">
Imagine we have the following table.<br />
<pre><code class="sql">CREATE TABLE MyTable (id int, name varchar, value int);

INSERT INTO MyTable (id,name,value) VALUES (1, 'Hello', 4);
INSERT INTO MyTable (id,name,value) VALUES (1, 'World', 8);
INSERT INTO MyTable (id,name,value) VALUES (5, 'Great!', 9);</code></pre>
The result we would like to acquire is:<br />
<pre>| id |   name_values    |
+----+------------------+
|  1 | Hello:4; World:8 |
|  5 | Great!:9         |</pre>
Names and values are concatenated into strings and grouped by id. We need an aggregate function, that concatenates strings for that. Here are some solutions for different sql databases.<br />
<dl>
<dt>MySql</dt>
<dd>This case is most easy one. Lucky users already have the <a class="external" href="http://dev.mysql.com/doc/refman/5.0/en/group-by-functions.html#function_group-concat">GROUP_CONCAT(expr)</a> function. This query should give the answer.
<br />
<pre><code class="sql">SELECT id, GROUP_CONCAT(name + ':' + value SEPARATOR '; ') AS name_values FROM MyTable GROUP BY id;</code></pre>
</dd>
<dt>PostgreSql</dt>
<dd>The solution here is a bit more difficult, but nevertheless easy enough. We need to create our own aggregate function and use it in our query.
<br />
<pre><code class="sql">CREATE AGGREGATE aggr_textcat(
  basetype    = text,
  sfunc       = textcat,
  stype       = text,
  initcond    = ''
);

SELECT id, substring(aggr_textcat(', ' || name || ':' || value) from 2) AS name_values FROM MyTable GROUP BY id;</code></pre>
Here we used already existing function to concatenate text fields <a class="external" href="http://www.postgresql.org/docs/8.3/static/functions-string.html">textcat</a>, but we could write our own.
</dd>
<dt>MsSql</dt>
<dd>Since version 2005 it became also possible to write your own aggregate function in MsSql, but here I provide another solution using inner select and xml path.
<br />
<pre><code class="sql">SELECT id, SUBSTRING((SELECT '; ' + name + ':' + CAST(value AS varchar(MAX)) 
FROM MyTable WHERE (id = Results.id) FOR XML PATH ('')),3,9999) AS name_values
FROM MyTable Results
GROUP BY id</code></pre>
</dd>
</dl>
</div>